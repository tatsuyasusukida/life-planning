# ライフプランニングシミュレーション API設計書

## 概要

ユーザーが自身の生年月日と開始・終了年を指定して、シンプルなライフプランシミュレーションを実行するためのAPIエンドポイントです。

## エンドポイント仕様

### POST /api/v1/life-planning/simulation

#### リクエスト

**Content-Type:** `application/json`

```json
{
  "生年月日": "1990-01-01",
  "開始年": 2020,
  "終了年": 2025
}
```

##### パラメータ

| パラメータ | 型 | 必須 | 説明 |
|---|---|---|---|
| 生年月日 | string | ✓ | 生年月日（ISO 8601形式: YYYY-MM-DD） |
| 開始年 | number | ✓ | シミュレーション開始年（西暦） |
| 終了年 | number | ✓ | シミュレーション終了年（西暦） |

#### レスポンス

##### 成功時（200 OK）

```json
{
  "年度一覧": [
    {
      "西暦年": 2020,
      "年齢": 30
    },
    {
      "西暦年": 2021,
      "年齢": 31
    },
    {
      "西暦年": 2022,
      "年齢": 32
    },
    {
      "西暦年": 2023,
      "年齢": 33
    },
    {
      "西暦年": 2024,
      "年齢": 34
    },
    {
      "西暦年": 2025,
      "年齢": 35
    }
  ]
}
```

##### エラー時（400 Bad Request）

```json
{
  "エラー": "エラーメッセージ"
}
```

## エラーケース

| エラーメッセージ | 発生条件 |
|---|---|
| "必須パラメータが不足しています: [パラメータ名]" | 必須パラメータが不足している |
| "[パラメータ名]の日付形式が正しくありません。YYYY-MM-DD形式で入力してください" | 生年月日の形式が不正 |
| "[パラメータ名]の型が正しくありません。[期待する型]型である必要がありますが、[実際の型]型が入力されました" | パラメータの型が不正 |
| "開始年は終了年以下である必要があります" | 開始年が終了年より大きい |
| "年齢が上限の150歳を超えています" | 終了年時点で150歳を超える |
| "JSONフォーマットが正しくありません" | リクエストボディのJSONが不正 |

## 実装詳細

### 年齢計算ロジック

年齢は各年の1月1日時点での満年齢として計算されます：

```
1月1日時点での満年齢 = 対象年 - 生年 - (1月1日 < その年の誕生日 ? 1 : 0)
```

この実装では、各年の1月1日時点で誕生日を迎えているかどうかを判定し、迎えていない場合は年齢から1を引きます。

### バリデーション

1. **Zodスキーマバリデーション**: リクエストボディの型、必須パラメータ、形式を自動検証
2. **年の範囲チェック**: 開始年 ≤ 終了年であることを確認
3. **年齢妥当性チェック**: 終了年時点で150歳を超えないことを確認
4. **JSONフォーマットチェック**: リクエストボディが有効なJSONかチェック

## 使用例

### 基本的な使用例

```bash
curl -X POST http://localhost:8787/api/v1/life-planning/simulation \
  -H "Content-Type: application/json" \
  -d '{
    "生年月日": "1990-01-01",
    "開始年": 2020,
    "終了年": 2025
  }'
```

### 単一年のシミュレーション

```bash
curl -X POST http://localhost:8787/api/v1/life-planning/simulation \
  -H "Content-Type: application/json" \
  -d '{
    "生年月日": "1985-06-15",
    "開始年": 2024,
    "終了年": 2024
  }'
```

### 失敗ケースの例

#### 必須パラメータ不足

```bash
curl -X POST http://localhost:8787/api/v1/life-planning/simulation \
  -H "Content-Type: application/json" \
  -d '{
    "生年月日": "1990-01-01",
    "開始年": 2024
  }'
```

**レスポンス:**
```json
{
  "エラー": "必須パラメータが不足しています: 終了年"
}
```

#### 不正な日付フォーマット

```bash
curl -X POST http://localhost:8787/api/v1/life-planning/simulation \
  -H "Content-Type: application/json" \
  -d '{
    "生年月日": "1990/01/01",
    "開始年": 2024,
    "終了年": 2025
  }'
```

**レスポンス:**
```json
{
  "エラー": "生年月日の日付形式が正しくありません。YYYY-MM-DD形式で入力してください"
}
```

#### 開始年が終了年より大きい

```bash
curl -X POST http://localhost:8787/api/v1/life-planning/simulation \
  -H "Content-Type: application/json" \
  -d '{
    "生年月日": "1990-01-01",
    "開始年": 2025,
    "終了年": 2024
  }'
```

**レスポンス:**
```json
{
  "エラー": "開始年は終了年以下である必要があります"
}
```

#### 不正な型

```bash
curl -X POST http://localhost:8787/api/v1/life-planning/simulation \
  -H "Content-Type: application/json" \
  -d '{
    "生年月日": "1990-01-01",
    "開始年": "invalid",
    "終了年": 2025
  }'
```

**レスポンス:**
```json
{
  "エラー": "開始年の型が正しくありません。number型である必要がありますが、string型が入力されました"
}
```

#### 年齢上限超過

```bash
curl -X POST http://localhost:8787/api/v1/life-planning/simulation \
  -H "Content-Type: application/json" \
  -d '{
    "生年月日": "1850-01-01",
    "開始年": 2024,
    "終了年": 2025
  }'
```

**レスポンス:**
```json
{
  "エラー": "年齢が上限の150歳を超えています"
}
```

#### 不正なJSONフォーマット

```bash
curl -X POST http://localhost:8787/api/v1/life-planning/simulation \
  -H "Content-Type: application/json" \
  -d '{
    "生年月日": "1990-01-01",
    "開始年": 2024,
    "終了年": 2025,
  }'
```

**レスポンス:**
```json
{
  "エラー": "JSONフォーマットが正しくありません"
}
```

## 将来の拡張可能性

- 誕生日を考慮した精密な年齢計算
- 収入・支出の予測機能
- ライフイベント（結婚、出産、退職など）の考慮
- 資産運用シミュレーション
- グラフ表示用データの生成